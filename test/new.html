<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../edit.css">
</head>

<body>
<div class="wx_temp">
    <div id="img-content" class="rich_media_wrp">

        <h1 class="rich_media_title " id="activity-name">

            《源码探秘 CPython》19. 字符集和字符编码
        </h1>
        <div id="meta_content" class="rich_media_meta_list">
                <span id="copyright_logo"
                      class="wx_tap_link js_wx_tap_highlight rich_media_meta icon_appmsg_tag appmsg_title_tag weui-wa-hotarea">原创</span>
            <span class="rich_media_meta rich_media_meta_text">
                    古明地觉
                </span>

            <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                    <a href="javascript:void(0);" class="wx_tap_link js_wx_tap_highlight weui-wa-hotarea" id="js_name">
                        古明地觉的编程教室 </a>
                    <div id="js_profile_qrcode" aria-hidden="true" class="profile_container" style="display:none;">
                        <div class="profile_inner">
                            <strong class="profile_nickname">古明地觉的编程教室</strong>
                            <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                            <p class="profile_meta">
                                <label class="profile_meta_label">微信号</label>
                                <span class="profile_meta_value">unwind_exception</span>
                            </p>

                            <p class="profile_meta">
                                <label class="profile_meta_label">功能介绍</label>
                                <span class="profile_meta_value">Python、Rust 程序猿，你感兴趣的内容我都会写，点个关注吧(#^.^#)</span>
                            </p>
                        </div>
                        <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                            <i class="profile_arrow arrow_out"></i>
                            <i class="profile_arrow arrow_in"></i>
                        </span>
                    </div>
                </span>
            <em id="publish_time" class="rich_media_meta rich_media_meta_text"></em>
            <em id="js_ip_wording_wrp" class="rich_media_meta rich_media_meta_text" role="option"
                style="display: none;">发表于<span id="js_ip_wording"></span></em>

        </div>


        <div id="js_tags" class="article-tag__list single-tag__wrp js_single js_wx_tap_highlight wx_tap_card"
             data-len="1" role="link" tabindex="0"
             aria-labelledby="js_article-tag-card__left js_a11y_comma js_article-tag-card__right">

                <span aria-hidden="true" id="js_article-tag-card__left" class="article-tag-card__left">
                    <span class="article-tag-card__title">收录于合集</span>
                    <span class="article-tag__item-wrp no-active js_tag"
                          data-url="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3NTczMDU2Mg==&amp;action=getalbum&amp;album_id=2206970536067497985#wechat_redirect"
                          data-tag_id="" data-album_id="2206970536067497985" data-tag_source="4">
                        <span class="article-tag__item">#CPython源码探秘</span>
                    </span>
                </span>
            <span aria-hidden="true" id="js_article-tag-card__right" class="article-tag-card__right">91个</span>
        </div>


        <div class="rich_media_content js_underline_content              " id="js_content">
            <p style="text-align: center;"><span style="color: rgb(217, 33, 66);"><strong><span
                    style="color: rgb(217, 33, 66);font-size: 24px;">楔子</span></strong></span><br/></p>
            <p style="text-align: center;"><span style="color: rgb(217, 33, 66);"><strong><span
                    style="color: rgb(217, 33, 66);font-size: 24px;"><br/></span></strong></span></p>
            <p>
                这一次我们分析一下Python的字符串，首先字符串是一个变长对象，因为不同长度的字符串所占的内存是不一样的；但同时字符串又是一个不可变对象，因为一旦创建就不可以再修改了。</p>
            <p><br/></p>
            <p>
                而Python中的字符串是通过unicode来表示的，在底层对应的结构体是PyUnicodeObject。不过话说回来，为什么需要unicode呢?</p>
            <p><br/></p>
            <p>
                首先计算机存储的基本单位是字节，由8个比特位组成，由于英文字母算上大小写只有52个，再加上若干字符，数量不会超过256个，因此一个字节完全可以表示。但是随着计算机的普及，越来越多的非英文字符出现，导致一个字节已经无法表示了。所以只能曲线救国，对于一个字节无法表示的字符，使用多个字节表示。
            </p>
            <p><br/></p>
            <p><span style="color: rgb(172, 57, 255);">但是这样会出现两个问题：</span></p>
            <ul class="list-paddingleft-2" style="list-style-type: disc;">
                <li>
                    <p>
                        因为每个国家都有自己的字符编码，所以不支持多国语言，例如中文的编码不可以包含日文，否则就会造成乱码；</p>
                </li>
                <li>
                    <p>没有统一标准，例如中文有GB2312、GBK、GB18030等多个标准；</p>
                </li>
            </ul>
            <p><br/></p>
            <p>到这里我们先不继续往下深入，我们先来理清楚一些概念。<br/></p>
            <p><br/></p>
            <p style="text-align: center;"><strong
                    style="color: rgb(217, 33, 66);text-align: center;white-space: normal;"><span
                    style="font-size: 24px;">字符集和字符编码</span></strong></p>
            <p><strong style="color: rgb(217, 33, 66);text-align: center;white-space: normal;"><span
                    style="font-size: 24px;"><br/></span></strong></p>
            <p>估计有很多小伙伴搞不清这两者的区别，我们先来解释一下所谓的字符集和字符编码是怎么一回事？</p>
            <p><br/></p>
            <p><span
                    style="color: rgb(172, 57, 255);"><strong>字符集</strong></span>：系统支持的所有字符组成的集合，像ASCII、GB2312、Big5、unicode都属于字符集。只不过不同的字符集所能容纳的字符个数不同，比如ASCII字符集中不包含中文，unicode则可以容纳世界上的所有字符；
            </p>
            <p><br/></p>
            <p><strong
                    style="color: rgb(172, 57, 255);white-space: normal;">字符编码</strong>：负责将每个字符转换成一个或多个计算机可以接受的具体数字，该数字可以理解为编号，因此字符编码维护了字符和编号之间的对应关系。而编码也分为多种，比如ascii、gbk、utf-8等等，字符编码不同，那么字符转换之后的编号也不同，当然能转化的字符种类也不同。比如ASCII这种字符编码，它就只能转换ASCII字符。
            </p>
            <blockquote class="js_blockquote_wrap" data-type="2" data-url="" data-author-name=""
                        data-content-utf8-length="57" data-source-title="">
                <section class="js_blockquote_digest">
                    <p>
                        当然，ASCII比较特殊，它既是字符集、也是字符编码。并且不管采用什么编码，ASCII字符对应的编号永远是相同的。</p>
                </section>
            </blockquote>
            <p>将字符串中的每一个字符转成对应的编号，那么得到的就是<span
                    style="color: rgb(0, 82, 255);"><strong>字节序列（bytes对象）</strong></span>，因为计算机存储和网络通讯的基本单位都是字节，所以字符串必须以字节序列的形式进行存储或传输。
            </p>
            <p><br/></p>
            <p>因此字符串和字节序列在某种程度上是很相似的，字符串按照指定的编码进行encode即可得到字节序列，<span
                    style="color: rgb(0, 82, 255);">也就是将每个字符都转成对应的编号</span>；字节序列按照相同的编码decode即可得到字符串，<span
                    style="color: rgb(0, 82, 255);">也就是</span><span
                    style="color: rgb(0, 82, 255);">根据编号找到对应的字符</span>。
            </p>
            <p><br/></p>
            <p>
                比如我们写了一段文本，然后在存储的时候必须先进行编码，也就是将每一个字符都转成一个或多个系统可以接受的数字、即对应的编号之后，才可以进行存储。</p>
            <section class="code-snippet__fix code-snippet__js">
                <ul class="code-snippet__line-index code-snippet__js">
                    <li></li>
                    <li></li>
                    <li></li>
                </ul>
                <pre class="code-snippet__js"
                     data-lang="makefile"><code><span class="code-snippet_outer">s = <span class="code-snippet__string">"你好"</span></span></code><code><span
                        class="code-snippet_outer"><span
                        class="code-snippet__comment">#&nbsp;编码之后就是一串数字</span></span></code><code><span
                        class="code-snippet_outer">print(s.encode(<span
                        class="code-snippet__string">"gbk"</span>))  <span class="code-snippet__comment"># b'\xc4\xe3\xba\xc3'</span></span></code></pre>
            </section>
            <p>假设文本中只有<span
                    style="color: rgb(0, 82, 255);"><strong>你好</strong></span>二字，在存储的时候采用gbk进行编码，那么在读取的时候也必须使用gbk进行解码，否则的话就会无法解析而报错。因为字符编码不同，字符对应的编号也不同。<br/>
            </p>
            <p><br/></p>
            <p>再比如每个国家都有自己的字符编码，你在日本的一台计算机上写好的文件拿到中国的计算机上打开，很有可能出现乱码。因为字符编码不同，字符和编号之间的对应关系也不同，采用不同的字符编码进行解析肯定会出问题。
            </p>
            <p><br/></p>
            <p>
                但我们说，对于ASCII字符来说，由于不管采用哪一种编码，它们得到的编号都是固定的。所以编码对于ASCII字符来说，没有任何影响。</p>
            <section class="code-snippet__fix code-snippet__js">
                <ul class="code-snippet__line-index code-snippet__js">
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                </ul>
                <pre class="code-snippet__js"
                     data-lang="python"><code><span class="code-snippet_outer">s = <span class="code-snippet__string">"abc"</span></span></code><code><span
                        class="code-snippet_outer">print(s.encode(<span
                        class="code-snippet__string">"gbk"</span>))  <span class="code-snippet__comment"># b'abc'</span></span></code><code><span
                        class="code-snippet_outer">print(s.encode(<span class="code-snippet__string">"gbk"</span>).decode(<span
                        class="code-snippet__string">"utf-8"</span>))  <span class="code-snippet__comment"># abc</span></span></code><code><span
                        class="code-snippet_outer"><br/></span></code><code><span class="code-snippet_outer"><span
                        class="code-snippet__comment"># 但如果是非ASCII字符，就不行了</span></span></code><code><span
                        class="code-snippet_outer"><span
                        class="code-snippet__keyword">try</span>:</span></code><code><span class="code-snippet_outer">    s = <span
                        class="code-snippet__string">"你好"</span></span></code><code><span class="code-snippet_outer">    s.encode(<span
                        class="code-snippet__string">"gbk"</span>).decode(<span
                        class="code-snippet__string">"utf-8"</span>)</span></code><code><span
                        class="code-snippet_outer"><span class="code-snippet__keyword">except</span> UnicodeError <span
                        class="code-snippet__keyword">as</span> e:</span></code><code><span class="code-snippet_outer">    <span
                        class="code-snippet__comment"># 报错了，无法解析</span></span></code><code><span
                        class="code-snippet_outer">    print(e)  </span></code><code><span class="code-snippet_outer">    <span
                        class="code-snippet__comment"># 'utf-8' codec can't decode byte 0xc4 in position 0: invalid continuation byte</span></span></code><code><span
                        class="code-snippet_outer"><br/></span></code></pre>
            </section>
            <p>这里我们再回忆一下bytes对象，我们创建的时候可以采用字面量的方式，比如 <strong><span
                    style="color: rgb(0, 82, 255);">b"abc"</span></strong>，但是 <span
                    style="color: rgb(0, 82, 255);"><strong>b"憨"</strong></span>却不可以。原因就是<span
                    style="color: rgb(0, 82, 255);"><strong>憨</strong></span>这个字符不是ASCII字符，那么采用不同的字符编码，其对应的编号是不同的，而这种方式Python又不知道我们使用哪一种编码，所以不允许这么做，而是需要通过<span
                    style="color: rgb(0, 82, 255);"><strong>"憨".encode</strong></span>的方式手动指定<span
                    style="color: rgb(0, 82, 255);"><strong>字符编码</strong></span>。</p>
            <p><br/></p>
            <p>但是对于 ASCII 字符而言，不管采用哪一种字符编码，得到的编号都是一样的，&nbsp;所以Python针对ASCII字符则允许这种做法，比如<span
                    style="color: rgb(0, 82, 255);"><strong>b"abc"</strong></span>。并且我们看到，对于汉字来说，在编码之后会对应多个编号，而每个编号占1字节，因此不同的字符所占的大小可能不同。
            </p>
            <p><br/></p>
            <p><br/></p>
            <p style="text-align: center;"><strong
                    style="text-align: center;white-space: normal;color: rgb(217, 33, 66);"><span
                    style="font-size: 24px;">小结</span></strong></p>
            <p><br/></p>
            <p>以上就是字符集和字符编码，字符集就是字符组成的集合，不同字符集所能容纳的字符数量是有限的。字符编码是将字符转成对应的编号，比如将一个字符串中的所有字符都转成对应的编号之后，就得到了字节序列。<br/>
            </p>
            <p><br/></p>
            <p>当然和字符集一样，字符编码能转换的字符种类也是有限的，像汉字我们可以使用 gbk 编码、utf-8 编码，但是不能使用
                ascii 编码。<br/></p>
            <p><br/></p>
            <p>
                以上算是理清楚了一些概念，显然过于简单了，主要是为后面的内容做铺垫。那么下一篇，就来从Python的角度分析字符串的存储方式。</p>
            <p><br/></p>
            <p><br/></p>
        </div>

        <script type="text/javascript" nonce="1964692100" reportloaderror>
            var first_sceen__time = (+new Date());
            if ("" == 1 && document.getElementById('js_content')) {
                document.getElementById('js_content').addEventListener("selectstart", function (e) {
                    e.preventDefault();
                });
            }
        </script>
    </div>
</div>
</body>

</html>